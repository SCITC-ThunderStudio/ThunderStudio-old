/* empty css             *//* empty css                  *//* empty css                        *//* empty css                  *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                    */import{d as z,t as E,u as M,l as j,k as o,y as B,m as $,h as s,E as K,o as D,a as u,g as t,b as V,H as O,f as x,n as W,q as S,M as q,p as A,x as G,c as Q,w as J,z as X,A as Y,B as Z,aS as ee,O as le,Q as te,D as ae}from"./index-x-5zwZLn.js";import{b as oe,c as ne,e as ie,f as se}from"./everyman-B1WBC58S.js";const ue={class:"flex items-center gap-10"},re={class:"h-14 min-h-14 w-14 min-w-14 rounded-full bg-blue-200 text-center"},de={class:"dialog-content"},pe={class:"flex h-20 justify-between"},ve=z({__name:"WeeklyManageUploadDialog",emits:["onUpdateWeeklyTableData"],setup(R,{expose:w,emit:C}){const h=C,{windowWidth:b}=E(M()),n=j({weeklyTitle:"",weeklyContent:""}),i=o([]),r=o(!1),y=o(b.value<=768?"90%":"40%"),f=o(!1);B(b,()=>{b.value<=768?y.value="90%":y.value="40%"});const v=()=>{if(i.value.length===0&&n.weeklyTitle===""&&n.weeklyContent===""){W.error("请上传文件或填写内容!");return}if(i.value.length!==0){if(i.value[0].size/1024/1024>10){W.warning("文件过大");return}f.value=!0,oe(i.value[0].raw).then(a=>{r.value=!a,a&&(n.weeklyTitle="",n.weeklyContent="",i.value=[],h("onUpdateWeeklyTableData")),f.value=!1})}else f.value=!0,ne(n).then(a=>{r.value=!a,a&&(n.weeklyTitle="",n.weeklyContent="",i.value=[],h("onUpdateWeeklyTableData")),f.value=!1})};return w({isUploadDialogVisible:r}),(a,e)=>{const k=S,T=q,c=A,U=K;return D(),$(U,{modelValue:r.value,"onUpdate:modelValue":e[4]||(e[4]=d=>r.value=d),width:y.value,"destroy-on-close":""},{header:s(()=>[u("div",ue,[u("div",re,[t(V(O),{class:"h-full w-full p-3 text-blue-600"})]),e[5]||(e[5]=u("div",null,[u("p",{class:"text-lg font-bold"},"周报上传"),u("p",{class:"text-xs text-gray-500"},"仅支持word文档，大小限制为10MB，优先上传文件")],-1))])]),footer:s(()=>[t(k,{onClick:e[3]||(e[3]=d=>r.value=!1)},{default:s(()=>e[7]||(e[7]=[x("取消")])),_:1}),t(k,{loading:f.value,type:"primary",onClick:v},{default:s(()=>e[8]||(e[8]=[x("上传")])),_:1},8,["loading"])]),default:s(()=>[u("div",de,[u("div",pe,[t(T,{"file-list":i.value,"onUpdate:fileList":e[0]||(e[0]=d=>i.value=d),"auto-upload":!1,accept:".doc,.docx,.xml,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document",class:"w-full"},{default:s(()=>[t(k,{type:"success"},{default:s(()=>e[6]||(e[6]=[x("选择文件")])),_:1})]),_:1},8,["file-list"]),t(c,{modelValue:n.weeklyTitle,"onUpdate:modelValue":e[1]||(e[1]=d=>n.weeklyTitle=d),class:"max-h-8",placeholder:"标题"},null,8,["modelValue"])]),u("div",null,[t(c,{modelValue:n.weeklyContent,"onUpdate:modelValue":e[2]||(e[2]=d=>n.weeklyContent=d),maxlength:200,rows:10,"show-word-limit":!0,placeholder:"内容",resize:"none",type:"textarea"},null,8,["modelValue"])])])]),_:1},8,["modelValue","width"])}}}),ce={class:"weekly-manage-header flex h-12 items-center justify-between border-b-2 border-solid border-inherit"},ge={class:"weekly-manage-content px-1.5 pt-3"},fe={class:"weekly-manage-pagination h-14 p-3"},Ue=z({__name:"WeeklyManageView",setup(R){const{windowWidth:w,windowHeight:C}=E(M()),h=o(),b=o(),n=o([]),i=o(!1),r=o(0),y=o(!1),f=o(0),v=o(1),a=o(w.value<=768?10:15),e=o(w.value<=768?5:9),k=o(w.value<=768?"prev, pager, next":"total, sizes, prev, pager, next");G(()=>{r.value=h.value.clientHeight-118,c(v.value,a.value)}),B([w,C],()=>{r.value=h.value.clientHeight-118,w.value<=768?(a.value=10,e.value=5,k.value="prev, pager, next"):(a.value=15,e.value=9,k.value="total, sizes, prev, pager, next")});const T=()=>{i.value=!0,setTimeout(()=>{i.value=!1},1e3),c(v.value,a.value)},c=(p,l)=>{y.value=!0,ie(p,l).then(m=>{console.debug("个人周报记录数据:",m),f.value=m.total,n.value=m.tableData,y.value=!1})},U=p=>{const l=void 0+encodeURIComponent(window.btoa(p));window.open(l)},d=p=>{te.confirm("是否删除此周报记录?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{se(p).then(l=>{l&&c(v.value,a.value)})}).catch(()=>{})},L=p=>{c(v.value,p)},P=p=>{c(p,a.value)};return(p,l)=>{const m=S,_=ae,H=X,N=Y,F=Z;return D(),Q("div",{ref_key:"weeklyManageContainerRef",ref:h,class:"weekly-manage-container h-full min-h-52 rounded-xl bg-base-100"},[u("div",ce,[t(m,{class:"ml-3",type:"primary",onClick:l[0]||(l[0]=g=>b.value.isUploadDialogVisible=!0)},{default:s(()=>l[4]||(l[4]=[x("文件上传 ")])),_:1}),t(m,{loading:i.value,class:"mr-3",type:"primary",onClick:T},{default:s(()=>l[5]||(l[5]=[x("刷新 ")])),_:1},8,["loading"])]),u("div",ge,[J((D(),$(H,{data:n.value,height:r.value,class:"rounded-lg","highlight-current-row":"",stripe:""},{default:s(()=>[t(_,{"show-overflow-tooltip":!0,align:"center",label:"文件名",prop:"fileName",width:"auto"}),t(_,{"show-overflow-tooltip":!0,align:"center",label:"提交时间","min-width":"85px",prop:"submitTime"}),t(_,{align:"center",label:"评论",prop:"evaluate","show-overflow-tooltip":"",width:"auto"}),t(_,{align:"center",label:"预览",width:"60px"},{default:s(g=>[t(m,{icon:V(ee),circle:"",type:"success",onClick:I=>U(g.row.filePath)},null,8,["icon","onClick"])]),_:1}),t(_,{label:"操作",width:"60px"},{default:s(g=>[t(m,{icon:V(le),circle:"",type:"danger",onClick:I=>d(g.row.weeklyId)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data","height"])),[[F,y.value]])]),u("div",fe,[t(N,{"current-page":v.value,"onUpdate:currentPage":l[1]||(l[1]=g=>v.value=g),"page-size":a.value,"onUpdate:pageSize":l[2]||(l[2]=g=>a.value=g),layout:k.value,"page-sizes":[5,10,15,20],"pager-count":e.value,total:f.value,onSizeChange:L,onCurrentChange:P},null,8,["current-page","page-size","layout","pager-count","total"])]),t(ve,{ref_key:"weeklyManageUploadDialogRef",ref:b,onOnUpdateWeeklyTableData:l[3]||(l[3]=g=>c(v.value,a.value))},null,512)],512)}}});export{Ue as default};
