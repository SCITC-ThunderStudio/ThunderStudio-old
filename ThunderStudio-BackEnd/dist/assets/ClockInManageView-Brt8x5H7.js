/* empty css             *//* empty css                  *//* empty css                   *//* empty css                        *//* empty css                  *//* empty css                        *//* empty css                  *//* empty css                     *//* empty css                    *//* empty css                 */import{d as N,t as j,u as G,k as o,l as B,y as L,G as Y,m as W,h as s,E as q,o as S,a as c,g as a,b as T,H as Z,f as z,I as ee,J as le,n as H,p as te,K as ae,L as oe,M as ne,N as ie,q as J,x as se,c as ue,w as re,z as de,A as ce,B as pe,O as ve,P as ge,Q as me,R as fe,D as _e,S as be}from"./index-x-5zwZLn.js";import{u as he,a as we,g as ke,d as Ce}from"./everyman-B1WBC58S.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ie={class:"flex items-center gap-10"},ye={class:"h-14 min-h-14 w-14 min-w-14 rounded-full bg-blue-200 text-center"},Ve={class:"dialog-content-left w-1/3"},Pe={class:"dialog-content-right w-2/3"},De=["src"],Fe=N({__name:"ClockInManageUploadDialog",emits:["onUpdateClockInTableData"],setup(A,{expose:h,emit:M}){const I=M,{windowWidth:w}=j(G()),V=o(),e=B({pictureFile:void 0,number:void 0,logs:""}),U=o(),v=o(!1),k=o(w.value<=768?"90%":"40%"),u=o([]),y=o(!1),g=o(""),r=o(!1),b=o(0);L(w,()=>{w.value<=768?k.value="90%":k.value="40%"}),L(b,()=>{b.value===0&&(e.pictureFile=void 0,e.number=void 0,e.logs=void 0,u.value=[])});const P=(n,l)=>{u.value=l.splice(-1)},D=n=>{n.url===void 0?g.value=n.toString():g.value=n.url,y.value=!0},F=Y({get(){return u.value.length>=1},set(){}}),C=(n,l)=>{const _={name:n.pictureFile.name,percentage:0,raw:n.pictureFile,size:n.pictureFile.size,status:"ready",uid:Math.floor(1e12+Math.random()*9e12),url:URL.createObjectURL(n.pictureFile)};U.value=n.recordsId,u.value[0]=_,e.number=n.number,e.logs=n.logs,b.value=l,v.value=!0},$=n=>{n&&n.validate().then(l=>{if(l){if(u.value.length===0)return H.warning("请上传文件"),!1;if(u.value[0].size/1024/1024>10)return H.warning("文件过大"),!1;switch(e.pictureFile=u.value[0].raw,r.value=!0,b.value){case 0:we(e.pictureFile,e.number,e.logs).then(_=>{r.value=!1,_&&(v.value=!1,n.resetFields(),e.pictureFile=void 0,e.logs="",u.value=[],I("onUpdateClockInTableData"))});break;case 1:he(U.value,e.pictureFile,e.number,e.logs).then(_=>{r.value=!1,_&&(v.value=!1,n.resetFields(),e.pictureFile=void 0,e.logs="",u.value=[],I("onUpdateClockInTableData"))})}}else return!1})},E=B({number:[{required:!0,message:"请输入数字",trigger:"blur"},{pattern:/^[1-9]\d*$/,message:"值为数字,且大于0",trigger:"blur"}]});return h({uploadOption:b,isUploadDialogVisible:v,handleClockInDataUpdate:C}),(n,l)=>{const _=te,R=ae,d=oe,t=ne,p=ie,m=J,x=q;return S(),W(x,{modelValue:v.value,"onUpdate:modelValue":l[5]||(l[5]=f=>v.value=f),width:k.value,"destroy-on-close":""},{header:s(()=>[c("div",Ie,[c("div",ye,[a(T(Z),{class:"h-full w-full p-3.5 text-blue-600"})]),l[6]||(l[6]=c("div",null,[c("p",{class:"text-lg font-bold"},"打卡上传"),c("p",{class:"text-xs text-gray-500"},"仅支持JPG/PNG格式，大小限制为10MB")],-1))])]),footer:s(()=>[a(m,{onClick:l[2]||(l[2]=f=>v.value=!1)},{default:s(()=>l[7]||(l[7]=[z("取消")])),_:1}),a(m,{loading:r.value,type:"primary",onClick:l[3]||(l[3]=f=>$(V.value))},{default:s(()=>l[8]||(l[8]=[z("上传 ")])),_:1},8,["loading"])]),default:s(()=>[a(p,{ref_key:"clockInFormRef",ref:V,model:e,rules:E,class:"dialog-content flex justify-center gap-5"},{default:s(()=>[c("div",Ve,[a(R,{prop:"number"},{default:s(()=>[a(_,{modelValue:e.number,"onUpdate:modelValue":l[0]||(l[0]=f=>e.number=f),placeholder:"做题数"},null,8,["modelValue"])]),_:1}),a(t,{"auto-upload":!1,class:ee({uploadHide:F.value}),"file-list":u.value,"on-change":P,"on-preview":D,"on-remove":()=>{u.value=[]},accept:".jpg,.png","list-type":"picture-card"},{default:s(()=>[a(d,null,{default:s(()=>[a(T(le))]),_:1})]),_:1},8,["class","file-list","on-remove"])]),c("div",Pe,[a(_,{modelValue:e.logs,"onUpdate:modelValue":l[1]||(l[1]=f=>e.logs=f),maxlength:100,"show-word-limit":!0,placeholder:"日志",resize:"none",rows:"9",type:"textarea"},null,8,["modelValue"])])]),_:1},8,["model","rules"]),a(x,{modelValue:y.value,"onUpdate:modelValue":l[4]||(l[4]=f=>y.value=f),width:k.value},{default:s(()=>[c("img",{src:g.value,alt:"Preview Image"},null,8,De)]),_:1},8,["modelValue","width"])]),_:1},8,["modelValue","width"])}}}),Ue=xe(Fe,[["__scopeId","data-v-64b2b0d3"]]),Te={class:"clock-in-manage-header flex h-12 items-center justify-between border-b-2 border-solid border-inherit"},ze={class:"clock-in-manage-content px-1.5 pt-3"},Me={class:"flex items-center"},$e={class:"clock-in-manage-pagination h-14 p-3"},Ee=["src"],Ke=N({__name:"ClockInManageView",setup(A){const{windowWidth:h,windowHeight:M}=j(G()),I=o(),w=o(),V=o([]),e=B({recordsId:void 0,pictureFile:void 0,number:void 0,logs:""}),U=o(!1),v=o(0),k=o(!1),u=o(""),y=o(0),g=o(1),r=o(h.value<=768?10:15),b=o(h.value<=768?5:9),P=o(h.value<=768?"prev, pager, next":"total, sizes, prev, pager, next"),D=o(!1),F=o(h.value<=768?"85%":"60%");se(()=>{v.value=I.value.clientHeight-118,C(g.value,r.value)}),L([h,M],()=>{v.value=I.value.clientHeight-118,h.value<=768?(F.value="85%",r.value=10,b.value=5,P.value="prev, pager, next"):(F.value="60%",r.value=15,b.value=9,P.value="total, sizes, prev, pager, next")});const C=(d,t)=>{k.value=!0,ke(d,t).then(p=>{console.debug("打卡记录数据:",p),y.value=p.total,V.value=p.tableData,k.value=!1})},$=()=>{C(g.value,r.value)},E=d=>{u.value=d,D.value=!0},n=d=>{me.confirm("是否删除此记录?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{Ce(d).then(t=>{t&&C(g.value,r.value)})}).catch(()=>{})},l=(d,t,p,m)=>{t=t.slice(t.indexOf("/",8)+1,t.length),fe(t).then(x=>{x!==null&&(e.recordsId=d,e.pictureFile=x,e.number=p,e.logs=m,w.value.handleClockInDataUpdate(e,1))})},_=d=>{C(g.value,d)},R=d=>{C(d,r.value)};return(d,t)=>{const p=J,m=_e,x=be,f=de,K=ce,Q=q,X=pe;return S(),ue("div",{ref_key:"clockInManageContainerRef",ref:I,class:"clock-in-manage-container h-full rounded-xl bg-base-100"},[c("div",Te,[a(p,{class:"ml-3",type:"primary",onClick:t[0]||(t[0]=i=>(w.value.isUploadDialogVisible=!0,w.value.uploadOption=0))},{default:s(()=>t[5]||(t[5]=[z("今日打卡 ")])),_:1}),a(p,{loading:U.value,class:"mr-3",type:"primary",onClick:$},{default:s(()=>t[6]||(t[6]=[z("刷新 ")])),_:1},8,["loading"])]),c("div",ze,[re((S(),W(f,{data:V.value,height:v.value,class:"rounded-lg","highlight-current-row":"",stripe:""},{default:s(()=>[a(m,{"show-overflow-tooltip":!0,align:"center",label:"提交时间","min-width":"85px",prop:"submitTime"}),a(m,{"show-overflow-tooltip":!0,align:"center",label:"更新时间","min-width":"85px",prop:"updateTime"}),a(m,{align:"center",label:"做题数","min-width":"70px",prop:"number"}),a(m,{"show-overflow-tooltip":!0,align:"center",label:"日志",prop:"logs",width:"auto"}),a(m,{align:"center",label:"图片",width:"100px"},{default:s(i=>[c("div",Me,[a(x,{src:i.row.picturePath,onClick:O=>E(i.row.picturePath)},null,8,["src","onClick"])])]),_:1}),a(m,{align:"center",label:"操作","min-width":"90px"},{default:s(i=>[a(p,{icon:T(ve),circle:"",type:"danger",onClick:O=>n(i.row.recordsId)},null,8,["icon","onClick"]),a(p,{icon:T(ge),circle:"",type:"primary",onClick:O=>l(i.row.recordsId,i.row.picturePath,i.row.number,i.row.logs)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data","height"])),[[X,k.value]])]),c("div",$e,[a(K,{"current-page":g.value,"onUpdate:currentPage":t[1]||(t[1]=i=>g.value=i),"page-size":r.value,"onUpdate:pageSize":t[2]||(t[2]=i=>r.value=i),layout:P.value,"page-sizes":[5,10,15,20],"pager-count":b.value,total:y.value,onSizeChange:_,onCurrentChange:R},null,8,["current-page","page-size","layout","pager-count","total"])]),a(Q,{modelValue:D.value,"onUpdate:modelValue":t[3]||(t[3]=i=>D.value=i),width:F.value,"destroy-on-close":"",title:"图片预览"},{default:s(()=>[c("img",{src:u.value,alt:"Preview Image",class:"picture-preview"},null,8,Ee)]),_:1},8,["modelValue","width"]),a(Ue,{ref_key:"ClockInManageUploadDialogRef",ref:w,onOnUpdateClockInTableData:t[4]||(t[4]=i=>C(g.value,r.value))},null,512)],512)}}});export{Ke as default};
